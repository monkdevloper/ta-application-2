<%- include('layout', { body: '' }) %>
<h1>Manage Applications</h1>

<% if (applications.length > 0) { %>
  <% applications.forEach(app => { %>
    <form action="/committee/update-status" method="POST" class="application-form">
      <p><strong>Course:</strong> <%= app.course.name %></p>
      <p><strong>Student:</strong> <%= app.student.username %></p>
      <p><strong>Skills:</strong> <%= app.skills %></p>
      <p><strong>Resume Link:</strong> <a href="<%= app.resumeLink %>" target="_blank">View Resume</a></p>
      <p><strong>Phone Number:</strong> <%= app.phoneNumber %></p>
      <p><strong>Current Status:</strong> 
        <%= app.status === 'pending' ? 'Pending Committee Approval' : 
            app.status === 'committee_approved' ? 'Committee Approved' :
            app.status === 'denied' ? 'Denied' : app.status %>
      </p>

      <!-- Hidden Input for Application ID -->
      <input type="hidden" name="applicationId" value="<%= app._id %>">

      <!-- Dropdown to Update Status -->
      <label for="status-<%= app._id %>"><strong>Update Status:</strong></label>
      <div class="select-container">
        <select id="status-<%= app._id %>" name="status" required>
          <option value="pending" <%= app.status === 'pending' ? 'selected' : '' %>>Pending</option>
          <option value="committee_approved" <%= app.status === 'committee_approved' ? 'selected' : '' %>>Approve (Committee)</option>
          <option value="denied" <%= app.status === 'denied' ? 'selected' : '' %>>Deny</option>
        </select>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="update-button">Update</button>
    </form>
  <% }) %>
<% } else { %>
  <p>No applications available to manage at the moment.</p>
<% } %>
<%- include('footer') %>
